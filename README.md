# geister_server

Geister用のゲームサーバ(作りかけ)．

## 動作概要(仮)
- 二つのクライアントとSocketで通信し，Geisterを進行する
- ボードの管理，勝敗の管理をする

## 盤面(仮)
        0 1 2 3 4 5
      0   h g f e
      1   d c b a
      2
      3
      4   A B C D
      5   E F G H
- サーバ側では表示のy=0の側を先手番の陣，y=5の側を後手番の陣とする
- プレーヤーは自分が先手なのか後手なのかによらず，y=5の側が自陣であるとする
- コマの名前は，ゲーム開始から終了まで変わらない
- コマが赤/青はゲーム開始前に，それぞれのクライアントに設定してもる

## ゲームの進行(仮)
- サーバー: python socket_server.pyで2つのプレーヤインスタンス(それぞれ8個のコマを持つ)を生成してクライアントからの通信を待つ
 - 先手のクライアントは10000番，後手のクライアントは10001番で待ち受ける
- クライアント: クライアントは先手/後手に応じて10000番/10001番に接続．recvして"SET?"という文字列を受信する
- クライアント: クライアントは赤オバケを4つセットし，recvする
 - 赤オバケをセットするコマンドは，SET:ABCD\r\n
 - 正しいコマンドでない場合はNGが返る
 - 正しいコマンドであった場合，次に盤面情報が送られてくるまで待つことになる
- サーバー: 2つのクライアントが赤のコマをセットし終えると，サーバーは先手番のクライアントに盤面情報を送る
 - 盤面情報はコマの(x,y)と色(相手に非公開の赤/青=R/B，両者が見えている赤=r/青=b/不明=u)を ABCDEFGHabcdefgh (ここで小文字は相手のコマ)順に，並べたもの
 - たとえば初期状態は，14R24R34R44R15B25B35B45B41u31u21u11u40u30u20u10u
 - 取られたコマの座標は(9,9)
 - 盤外に逃げ出したコマンドの座標は(8,8)
 - 取った/取られたコマおよび盤外のコマ色は公開される．
 - 自分の手番によらずどちらのクラントも同じ方向からのビューを持つ(5の側が自陣，0の側が相手陣)
- クライアント: 先手番のクライアントは手を打ち，recvする．
 - 手を打つには， MOV:A,NORTH\r\n のように動かすコマ名と方角を送る
 - 方角はNORTH/EAST/WEST/SOUTHの4種類
 - 正しいコマンドでない場合はNGが返る
 - 正しいコマンドであった場合，次に盤面情報が送られてくるまで待つことになる
- サーバー: サーバーは先手番の手を受理したら，後手番のクライアントに更新後の盤面情報を送る
- クライアント: 後手番のクライアントは手を打ち，recvする．

## 実行例
サーバー
    %run socket_server.py

クライアント0(先手番):
    In [123]: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    In [124]: s.connect(("localhost", 10000)); s.recv(4096)
    Out[124]: b'SET?'
    In [125]: s.send(b"SET:ABCD\r\n"); s.recv(4096) # クライアント1のSETコマンド完了(In[157])までブロック
    Out[125]: b'14R24R34R44R15B25B35B45B41u31u21u11u40u30u20u10u'
    In [126]: s.send(b"MOV:A,NORTH\r\n"); s.recv(4096) # クライアント1のMOVコマンド完了(In[158])までブロック
    Out[126]: b'13R24R34R44R15B25B35B45B42u31u21u11u40u30u20u10u'

クライアント1(後手番):
    In [155]: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    In [156]: s.connect(("localhost", 10001)); s.recv(4096)
    Out[156]: b'SET?'
    In [157]: s.send(b"SET:BCDE\r\n"); s.recv(4096) # クライアント0のMOVコマンド完了(In[126])までブロック
    Out[157]: b'14B24R34R44R15R25B35B45B42u31u21u11u40u30u20u10u'
    In [158]: s.send(b"MOV:A,NORTH\r\n"); s.recv(4096) # クライアント0の次のMOVコマンド完了までブロック
